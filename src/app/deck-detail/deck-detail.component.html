<!-- TODO prevent bad inputs -->

<div class="left padded table wid">
  <div class="mat-elevation-z8">
    <table mat-table [dataSource]="dataSource" matSort>
      
      <!-- Card Column -->
      <ng-container matColumnDef="card">
        <th mat-header-cell *matHeaderCellDef> Card </th>
        <td mat-cell *matCellDef="let card"> {{card.name}} </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>
      
      <!-- Condition Column -->
      <ng-container matColumnDef="condition">
        <th mat-header-cell *matHeaderCellDef> Condition </th>
        <td mat-cell *matCellDef="let card"> {{(card.cardCondition || '') + (card.isFoil ? ' Foil' : '')}} </td>
        <td mat-footer-cell *matFooterCellDef></td>
      </ng-container>

      <!-- Version Column -->
      <ng-container matColumnDef="version">
        <th mat-header-cell *matHeaderCellDef> Version </th>
        <td mat-cell *matCellDef="let card"> {{card.version}} </td>
        <td mat-footer-cell *matFooterCellDef> Total </td>
      </ng-container>

      <!-- Quantity Column -->
      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef> Quantity </th>
        <td mat-cell *matCellDef="let card"> {{card.quantity}} </td>
        <td mat-footer-cell *matFooterCellDef> {{getTotalQuantity()}} </td>
      </ng-container>

      <!-- Value Column -->
      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef> Value </th>
        <td mat-cell *matCellDef="let card"> {{card.marketPrice * card.quantity | currency}} </td>
        <td mat-footer-cell *matFooterCellDef> {{getTotalCost() | currency}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns; let i = index" (click)="setCard(i)" style="cursor: pointer"></tr>
      <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
    </table>
  </div>

  <!-- Disable refresh on decks other than overview until graph can be made smarter -->
  <span *ngIf="selectedDeck">
    <span *ngIf="selectedDeck.id === 0">
      <span *ngIf="!loading">
        <button mat-raised-button (click)="refreshDeck()" class="but">Refresh</button>
      </span>
      <span *ngIf="loading">
        <button mat-raised-button class="but">
          <mat-progress-spinner style="margin:0 auto;" mode="indeterminate" [diameter]="15"></mat-progress-spinner>
        </button>
      </span>
    </span>
  </span>
</div>

<div class="right">
  <ul class="decks">
    <li *ngFor="let deck of decks" (click)="setDeck(deck.id)">
      <span  class="badge">{{deck.id}}</span> {{deck.name}}
    </li>
  </ul>
</div>

<mat-card class="center deck">
  <div *ngIf="selectedDeck">
    <mat-card-title> <input [(ngModel)]="selectedDeck.name" placeholder="Deck Name"/> </mat-card-title>
    <mat-card-actions>
      <!-- Prevent rename deck overview -->
      <span *ngIf="selectedDeck.id !== 0">
        <button mat-raised-button (click)="saveDeck()" class="padded" style="margin: 1px 5px">Update Deck</button>
        <button mat-raised-button (click)="deleteDeck()" class="padded" style="margin: 1px 5px auto 5px">Delete Deck</button>
      </span>
      <button mat-raised-button (click)="resetSelectedDeck()" class="padded" style="margin: 1px auto auto 5px">Add New Deck</button>
    </mat-card-actions>
  </div>
</mat-card>

<div *ngIf="selectedCard">
  <span *ngIf="selectedDeck.id !== 0">
    <mat-card class="center card">
      <mat-card-title> <input [(ngModel)]="selectedCard.name" placeholder="Name"/> </mat-card-title>
      <mat-card-subtitle>	
        <input [(ngModel)]="selectedCard.version" placeholder="Version"/>
        <input [(ngModel)]="selectedCard.purchasePrice" placeholder="Purchase Price"/> 

        <!-- TODO styling -->

        <form [formGroup]="foilForm">
          <label for="foilOptions">Foil</label>
          <select formControlName="foilOptions" id="foilOptions">
            <option *ngFor="let foilOption of foilOptions; let i = index" [ngValue]="foilOptions[i].id">
              {{foilOptions[i].name}}
            </option>
          </select>
        </form>

        <form [formGroup]="conditionForm">
          <label for="conditionOptions">Condition</label>
          <select formControlName="conditionOptions" id="conditionOptions">
            <option *ngFor="let conditionOption of conditionOptions; let i = index" [ngValue]="conditionOptions[i].id">
              {{conditionOptions[i].name}}
            </option>
          </select>
        </form>

        <form [formGroup]="decksForm">
            <label for="decksOptions">Deck</label>
            <select formControlName="decksOptions" id="decksOptions">
              <option *ngFor="let decksOption of decksOptions; let i = index" [ngValue]="decksOptions[i].id">
                {{decksOptions[i].name}}
              </option>
            </select>
          </form>
        <input [(ngModel)]="selectedCard.quantity" placeholder="Quantity"/> 
      </mat-card-subtitle>

      <!-- TODO pull card description from backend -->
      <!-- <mat-card-content> Primary card content. Intended for blocks of text. </mat-card-content> -->
      <img mat-card-image src={{selectedCard.url}} style="width: 200px; height: 285px; border: 2px solid black">
      <mat-card-actions>
        <button mat-raised-button (click)="saveCard()" class="padded">Update Card</button>
        <button mat-raised-button (click)="deleteCard()" class="padded">Delete Card</button>
        <button mat-raised-button (click)="resetSelectedCard()" class="padded">Add New Card</button>
      </mat-card-actions>
    </mat-card>
  </span>
</div>
